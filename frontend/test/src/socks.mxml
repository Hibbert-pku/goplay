<?xml version="1.0" encoding="utf-8"?>
<s:Application xmlns:fx="http://ns.adobe.com/mxml/2009" 
			   xmlns:s="library://ns.adobe.com/flex/spark" 
			   xmlns:mx="library://ns.adobe.com/flex/mx" minWidth="955" minHeight="600" creationComplete="configureListeners()">
	
	<fx:Script>
		<![CDATA[
			include "protocol/server.as";
			
			import flash.events.IOErrorEvent;
			import flash.events.ProgressEvent;
			import flash.events.SecurityErrorEvent;
			import flash.net.Socket;
			
			import mx.controls.Alert;
			import mx.utils.ObjectUtil;
			
			public var socket:Socket = new Socket();
			
			private function configureListeners():void {
				socket.addEventListener(Event.CONNECT, connected);
				socket.addEventListener(Event.CLOSE, disconnected);
				socket.addEventListener(IOErrorEvent.IO_ERROR, io_error);
				socket.addEventListener(SecurityErrorEvent.SECURITY_ERROR, security_error);
				socket.addEventListener(ProgressEvent.SOCKET_DATA, socket_data);
			}
			
			public function read_data():String {
				return ObjectUtil.toString(socket.readObject());
				var x:Object = new Object();
			}
			
			public function send_data(object:*):void {
				socket.writeObject(object);
				socket.flush();
			}
			
			private function connected(event:Event):void {
				status_lbl.text = "Connected";
				status_lbl.setStyle("color", "#00FF00");
				connect_btn.label = "Disconnect";
				connect_btn.enabled = true;
			}
			
			private function disconnected(event:Event):void {
				status_lbl.text = "Disconnected";
				status_lbl.setStyle("color", "#FF0000");
				connect_btn.label = "Connect";
				connect_btn.enabled = true;
			}
			
			private function io_error(event:IOErrorEvent):void {
				Alert.show(event.text);
			}
			
			private function security_error(event:SecurityErrorEvent):void {
				Alert.show(event.text);
				connect_btn.enabled = true;
			}
			
			private function socket_data(event:ProgressEvent):void {
					receiver_txt.appendText(read_data()+"\n\n");
			}
			
			// =================================
			
			private function connect_btn_click():void {
				connect_btn.enabled = false;
				if (connect_btn.label == "Connect") {
					socket.connect("127.0.0.1", 7777);
				} else {
					socket.close();
					disconnected(null);
				}
			}
		]]>
	</fx:Script>
	
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
	</fx:Declarations>
	<s:TextArea x="66" y="143" width="602" editable="false" id="receiver_txt" height="362" useHandCursor="true"/>
	<s:TextInput x="66" y="513" width="544" id="commander_txt"/>
	<s:Button x="618" y="513" label="Send" id="send_btn"/>
	<s:Label x="66" y="36" text="Status:"/>
	<s:Label x="113" y="36" text="Disconnected" color="#FF0000" id="status_lbl"/>
	<s:Button x="66" y="81" label="Connect" id="connect_btn" click="connect_btn_click()"/>
	<s:Label x="687" y="10" text="username:"/>
	<s:Label x="687" y="37" text="password:"/>
	<s:TextInput x="765" y="10" id="username_txt"/>
	<s:TextInput x="765" y="37" id="password_txt" displayAsPassword="true"/>
	<s:Button x="901" y="10" label="login" height="46" id="login_btn" click="send_data(login(username_txt.text, password_txt.text))"/>
</s:Application>
